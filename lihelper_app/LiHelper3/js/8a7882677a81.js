(function(){var a=function(a,b){return function(){return a.apply(b,arguments);};},b=Object.prototype.hasOwnProperty,c=function(a,c){for(var d in c)if(b.call(c,d))a[d]=c[d];function e(){this.constructor=a;}e.prototype=c.prototype;a.prototype=new e();a.__super__=c.prototype;return a;};$(function(){return Kippt.Views.NotificationsModal=(function(b){c(d,b);function d(){this.viewMore=a(this.viewMore,this);this.openLink=a(this.openLink,this);this.toggleModal=a(this.toggleModal,this);this.close=a(this.close,this);this.addNotification=a(this.addNotification,this);this.addAllNotifications=a(this.addAllNotifications,this);this.render=a(this.render,this);this.data=a(this.data,this);this.initialize=a(this.initialize,this);d.__super__.constructor.apply(this,arguments);}d.prototype.el='#notifications-modal';d.prototype.template=Kippt.Templates.notifications_modal;d.prototype.events={'click .notifications-link':'toggleModal','click ul a':'openLink','click .more':'viewMore'};d.prototype.initialize=function(){this.collection.on("reset",this.render);this.collection.on("add",this.render);this.render();return this.addAllNotifications();};d.prototype.data=function(){return{'notifications':this.collection.toJSON()};};d.prototype.render=function(){return this.$el.html(this.template(this.data()));};d.prototype.addAllNotifications=function(){if(this.collection.models.length){this.collection.each(this.addNotification);if(this.hasNotifications)this.$el.addClass('has-notifications');return this.$('.empty').remove();}else return this.$el.addClass('no-notifications');};d.prototype.addNotification=function(a){var b;b=new Kippt.Views.NotificationModal({model:a});this.$('ul').append(b.render().el);this.$el.find(".timeago").timeagoTiny();if(!a.get('is_seen'))return this.hasNotifications=true;};d.prototype.close=function(){this.$('.notifications').fadeOut(150);this.$el.removeClass('open');return $(document).off("click",this);};d.prototype.toggleModal=function(a){var b=this;a.preventDefault();if(this.$('.notifications').is(':hidden')){this.$('.notifications').show();this.$el.addClass('open');this.$el.removeClass('has-notifications');this.collection.markAsSeen();setTimeout((function(){return b.$('li').removeClass('unread');}),1500);$(document).one("click",this.close);}else this.close();return false;};d.prototype.openLink=function(a){this.close();if(Kippt.app){Kippt.app.navigate($(a.currentTarget).attr('href'),true);return false;}};d.prototype.viewMore=function(){this.close();if(Kippt.app){Kippt.app.navigate('/notifications',true);return false;}};return d;})(Backbone.View);});}).call(this);(function(){var a=function(a,b){return function(){return a.apply(b,arguments);};},b=Object.prototype.hasOwnProperty,c=function(a,c){for(var d in c)if(b.call(c,d))a[d]=c[d];function e(){this.constructor=a;}e.prototype=c.prototype;a.prototype=new e();a.__super__=c.prototype;return a;};$(function(){return Kippt.Views.NotificationModal=(function(b){c(d,b);function d(){this.data=a(this.data,this);this.render=a(this.render,this);d.__super__.constructor.apply(this,arguments);}d.prototype.tagName='li';d.prototype.render=function(){if(this.model.get('type')==='new_clip')this.$el.html(Kippt.Templates.notification_modal_clip(this.data()));if(this.model.get('type')==='new_comment')this.$el.html(Kippt.Templates.notification_modal_comment(this.data()));if(this.model.get('type')==='clip_like')this.$el.html(Kippt.Templates.notification_modal_like(this.data()));this.$el.addClass(this.model.get('type'));if(!this.model.get('is_seen'))this.$el.addClass('unread');return this;};d.prototype.data=function(){return _.extend(this.model.toJSON(),{});};return d;})(Backbone.View);});}).call(this);(function(){var a=function(a,b){return function(){return a.apply(b,arguments);};},b=Object.prototype.hasOwnProperty,c=function(a,c){for(var d in c)if(b.call(c,d))a[d]=c[d];function e(){this.constructor=a;}e.prototype=c.prototype;a.prototype=new e();a.__super__=c.prototype;return a;};$(function(){return Kippt.Views.ClipComment=(function(b){c(d,b);function d(){this["delete"]=a(this["delete"],this);this.data=a(this.data,this);this.render=a(this.render,this);d.__super__.constructor.apply(this,arguments);}d.prototype.tagName='li';d.prototype.events={'click .delete':'delete'};d.prototype.render=function(){return this.$el.html(Kippt.Templates.clip_comment(this.data()));};d.prototype.data=function(){var a;if(Kippt.currentUser&&(this.commentData.user.id===Kippt.currentUser.id||this.clipData.user.id===Kippt.currentUser.id)){a=true;this.$el.addClass('canDelete');}return _.extend(this.commentData,{canDelete:a});};d.prototype["delete"]=function(a){var b,c=this;a.preventDefault();if(confirm('Are you sure you want to delete this comment?')){this.$el.hide();b=$.ajax({url:this.commentData.resource_uri,type:'DELETE'});b.done(function(){return c.remove();});return b.fail(function(){alert('Something went wrong.');return c.$el.show();});}};return d;})(Backbone.View);});}).call(this);(function(){var a=function(a,b){return function(){return a.apply(b,arguments);};},b=Object.prototype.hasOwnProperty,c=function(a,c){for(var d in c)if(b.call(c,d))a[d]=c[d];function e(){this.constructor=a;}e.prototype=c.prototype;a.prototype=new e();a.__super__=c.prototype;return a;};$(function(){return Kippt.Views.ClipLike=(function(b){c(d,b);function d(){this.render=a(this.render,this);d.__super__.constructor.apply(this,arguments);}d.prototype.tagName='li';d.prototype.render=function(){return this.$el.html(Kippt.Templates.clip_like(this.data));};return d;})(Backbone.View);});}).call(this);(function(){var a=function(a,b){return function(){return a.apply(b,arguments);};},b=Object.prototype.hasOwnProperty,c=function(a,c){for(var d in c)if(b.call(c,d))a[d]=c[d];function e(){this.constructor=a;}e.prototype=c.prototype;a.prototype=new e();a.__super__=c.prototype;return a;};$(function(){return Kippt.Views.ClipSavePopup=(function(b){c(d,b);function d(){this.close=a(this.close,this);this.save=a(this.save,this);this.data=a(this.data,this);this.render=a(this.render,this);this.initialize=a(this.initialize,this);d.__super__.constructor.apply(this,arguments);}d.prototype.template=Kippt.Templates.clip_save_popup;d.prototype.events={'submit form':'save'};d.prototype.initialize=function(a){this.lists=a.lists;this.parentElem=a.parentElem;return this.$el.outsider(this.close);};d.prototype.render=function(a,b){this.$el.html(this.template(this.data()));this.$el.css({left:a,top:b});this.$el.show();if(this.parentElem)$(this.parentElem).addClass('saving');return $(document).bind('keydown','esc',this.close);};d.prototype.data=function(){return _.extend(this.model.toJSON(),{lists:this.lists.toJSON()});};d.prototype.save=function(a){var b,c,d,e;a.preventDefault();e=this.$('textarea').val();c=this.$('select option:selected').val();b=this.lists.get(c);d=new Kippt.Models.Clip({url:this.model.get('url'),user:Kippt.currentUser.get('resource_uri'),list:b.get('resource_uri'),notes:e,via:this.model.get('resource_uri'),urlRoot:'/api/clips/'});d.save().error(function(a,b,c){return alert('Something went wrong.');});return this.close();};d.prototype.close=function(a){this.$el.fadeOut();if(this.parentElem)$(this.parentElem).removeClass('saving');return $(document).unbind('keydown',this.close);};return d;})(Backbone.View);});}).call(this);